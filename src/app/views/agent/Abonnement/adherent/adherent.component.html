<div class="gestion-adherents-container">
  <div class="gestion-adherents">
    <!-- Success Message -->
    <div class="success-message" *ngIf="showSuccess" @fadeAnimation>
      {{ successMessage }}
    </div>

    <!-- Modal for Adding an Adherent -->
    <div class="modal" *ngIf="showModal" @modalAnimation>
      <div class="modal-content">
        <h2 class="modal-title">Ajouter un adhérent</h2>
        <div *ngIf="formErrors.length > 0" class="error-messages">
          <p *ngFor="let error of formErrors" class="error">{{ error }}</p>
        </div>
        <div *ngIf="backendErrors.length > 0" class="error-messages">
          <p *ngFor="let error of backendErrors" class="error">{{ error }}</p>
        </div>
        <form (ngSubmit)="saveAdherent()" #adherentForm="ngForm">
          <!-- Personal Information -->
          <div class="form-section">
            <h3>Informations Personnelles</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="nom">Nom <span class="required">*</span></label>
                <input
                  id="nom"
                  type="text"
                  [(ngModel)]="currentAdherent.nom"
                  name="nom"
                  required
                  class="form-input"
                  placeholder="Nom"
                  #nom="ngModel"
                  aria-label="Nom"
                />
                <span class="error" *ngIf="nom.invalid && nom.touched">Le nom est obligatoire</span>
              </div>
              <div class="form-group">
                <label for="prenom">Prénom <span class="required">*</span></label>
                <input
                  id="prenom"
                  type="text"
                  [(ngModel)]="currentAdherent.prenom"
                  name="prenom"
                  required
                  class="form-input"
                  placeholder="Prénom"
                  #prenom="ngModel"
                  aria-label="Prénom"
                />
                <span class="error" *ngIf="prenom.invalid && prenom.touched">Le prénom est obligatoire</span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group full-width">
                <label for="email">Email <span class="required">*</span></label>
                <input
                  id="email"
                  type="email"
                  [(ngModel)]="currentAdherent.email"
                  name="email"
                  required
                  email
                  class="form-input"
                  placeholder="Email"
                  #email="ngModel"
                  aria-label="Email"
                />
                <span class="error" *ngIf="email.invalid && email.touched">Email valide requis</span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group full-width">
                <label for="adresse">Adresse</label>
                <input
                  id="adresse"
                  type="text"
                  [(ngModel)]="currentAdherent.adresse"
                  name="adresse"
                  class="form-input"
                  placeholder="Adresse"
                  aria-label="Adresse"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="tel1">Téléphone 1 <span class="required">*</span></label>
                <input
                  id="tel1"
                  type="text"
                  [(ngModel)]="currentAdherent.tel1"
                  name="tel1"
                  required
                  pattern="\d{8}"
                  class="form-input"
                  placeholder="Téléphone (8 chiffres)"
                  #tel1="ngModel"
                  aria-label="Téléphone 1"
                />
                <span class="error" *ngIf="tel1.invalid && tel1.touched">Téléphone doit être 8 chiffres</span>
              </div>
              <div class="form-group">
                <label for="tel2">Téléphone 2</label>
                <input
                  id="tel2"
                  type="text"
                  [(ngModel)]="currentAdherent.tel2"
                  name="tel2"
                  class="form-input"
                  placeholder="Téléphone 2"
                  aria-label="Téléphone 2"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="cin">CIN <span class="required">*</span></label>
                <input
                  id="cin"
                  type="text"
                  [(ngModel)]="currentAdherent.cin"
                  name="cin"
                  required
                  pattern="\d{8}"
                  class="form-input"
                  placeholder="Entrez le CIN (8 chiffres)"
                  #cin="ngModel"
                  aria-label="CIN"
                />
                <span class="error" *ngIf="cin.invalid && cin.touched">CIN doit être 8 chiffres</span>
              </div>
            </div>
          </div>

          <!-- Professional Information -->
          <div class="form-section">
            <h3>Informations Professionnelles</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="profession">Profession</label>
                <input
                  id="profession"
                  type="text"
                  [(ngModel)]="currentAdherent.profession"
                  name="profession"
                  class="form-input"
                  placeholder="Profession"
                  aria-label="Profession"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="datenaissance">Date de Naissance</label>
                <input
                  id="datenaissance"
                  type="date"
                  [(ngModel)]="currentAdherent.datenaissance"
                  name="datenaissance"
                  class="form-input"
                  aria-label="Date de naissance"
                />
              </div>
            </div>
            <div class="form-row">
              <div class="form-group full-width">
                <label for="codetva">Code TVA <span class="required">*</span></label>
                <input
                  id="codetva"
                  type="text"
                  [(ngModel)]="currentAdherent.codetva"
                  name="codetva"
                  required
                  class="form-input"
                  placeholder="Code TVA"
                  #codetva="ngModel"
                  aria-label="Code TVA"
                />
                <span class="error" *ngIf="codetva.invalid && codetva.touched">Le Code TVA est obligatoire</span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group full-width">
                <label for="raisonsoc">Raison Sociale <span class="required">*</span></label>
                <input
                  id="raisonsoc"
                  type="text"
                  [(ngModel)]="currentAdherent.raisonsoc"
                  name="raisonsoc"
                  required
                  class="form-input"
                  placeholder="Raison sociale"
                  #raisonsoc="ngModel"
                  aria-label="Raison Sociale"
                />
                <span class="error" *ngIf="raisonsoc.invalid && raisonsoc.touched">La Raison Sociale est obligatoire</span>
              </div>
            </div>
          </div>

          <!-- Other Information -->
          <div class="form-section">
            <h3>Autres Informations</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="idpointage">ID Pointage <span class="required">*</span></label>
                <input
                  id="idpointage"
                  type="text"
                  [(ngModel)]="currentAdherent.idpointage"
                  name="idpointage"
                  required
                  class="form-input"
                  placeholder="ID pointage"
                  #idpointage="ngModel"
                  aria-label="ID Pointage"
                />
                <span class="error" *ngIf="idpointage.invalid && idpointage.touched">L'ID Pointage est obligatoire</span>
              </div>
              <div class="form-group">
                <label for="societe_code">Code Société <span class="required">*</span></label>
                <input
                  id="societe_code"
                  type="text"
                  [(ngModel)]="currentAdherent.societe_code"
                  name="societe_code"
                  required
                  class="form-input"
                  placeholder="Code société"
                  #societe_code="ngModel"
                  aria-label="Code Société"
                />
                <span class="error" *ngIf="societe_code.invalid && societe_code.touched">Le Code Société est obligatoire</span>
              </div>
            </div>
          </div>

          <div class="modal-actions">
            <button type="button" class="cancel-btn" (click)="closeModal()" aria-label="Annuler">Annuler</button>
            <button
              type="submit"
              class="save-btn"
              [disabled]="!adherentForm.valid || isSaving"
              aria-label="Sauvegarder"
            >
              {{ isSaving ? 'Sauvegarde...' : 'Sauvegarder' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal for Viewing an Adherent -->
    <div class="modal" *ngIf="showViewModal" @modalAnimation>
      <div class="modal-content">
        <h2 class="modal-title">Détails de l'adhérent</h2>
        <div class="user-details">
          <p><strong>Code :</strong> {{ viewedAdherent?.code || 'N/A' }}</p>
          <p><strong>Nom :</strong> {{ viewedAdherent?.nom || 'N/A' }}</p>
          <p><strong>Prénom :</strong> {{ viewedAdherent?.prenom || 'N/A' }}</p>
          <p><strong>Profession :</strong> {{ viewedAdherent?.profession || 'N/A' }}</p>
          <p><strong>Email :</strong> {{ viewedAdherent?.email || 'N/A' }}</p>
          <p><strong>Adresse :</strong> {{ viewedAdherent?.adresse || 'N/A' }}</p>
          <p><strong>Téléphone 1 :</strong> {{ viewedAdherent?.tel1 || 'N/A' }}</p>
          <p><strong>Téléphone 2 :</strong> {{ viewedAdherent?.tel2 || 'N/A' }}</p>
          <p><strong>CIN :</strong> {{ viewedAdherent?.cin || 'N/A' }}</p>
          <p><strong>Date de naissance :</strong> {{ viewedAdherent?.datenaissance || 'N/A' }}</p>
          <p><strong>Code TVA :</strong> {{ viewedAdherent?.codetva || 'N/A' }}</p>
          <p><strong>Raison sociale :</strong> {{ viewedAdherent?.raisonsoc || 'N/A' }}</p>
          <p><strong>ID Pointage :</strong> {{ viewedAdherent?.idpointage || 'N/A' }}</p>
          <p><strong>Code Société :</strong> {{ viewedAdherent?.societe_code || 'N/A' }}</p>
        </div>
        <div class="modal-actions">
          <button class="close-btn" (click)="closeViewModal()" aria-label="Fermer">Fermer</button>
        </div>
      </div>
    </div>

    <!-- Modal for Delete Confirmation -->
    <div class="modal" *ngIf="showDeleteConfirm" @modalAnimation>
      <div class="modal-content">
        <h2 class="modal-title">Confirmer la suppression</h2>
        <p class="modal-text">Êtes-vous sûr de vouloir supprimer l'adhérent {{ adherentToDelete?.code }} ?</p>
        <div class="modal-actions">
          <button class="cancel-btn" (click)="cancelDelete()" aria-label="Annuler">Annuler</button>
          <button class="delete-btn" (click)="deleteAdherent()" aria-label="Supprimer">Supprimer</button>
        </div>
      </div>
    </div>

    <!-- Header Section -->
    <div class="header">
      <div class="header-title">
        <h1>Gestion des Adhérents</h1>
        <p>Liste des adhérents enregistrés ({{ filteredAdherents.length }} adhérents)</p>
      </div>
      <button class="add-btn" (click)="openAddAdherentModal()" aria-label="Ajouter un adhérent">+ Ajouter un adhérent</button>
    </div>

    <!-- Search and Filter Section -->
    <div class="search-filter">
      <div class="search">
        <input
          type="text"
          placeholder="Rechercher un adhérent..."
          [(ngModel)]="searchQuery"
          (input)="applyFilters()"
          class="search-input"
          aria-label="Rechercher un adhérent"
        />
        <span class="search-icon">🔍</span>
      </div>
      <div class="filter-container">
        <button class="filter-btn" (click)="toggleFilter()" aria-label="Ouvrir les filtres">Filtrer</button>
        <div class="filter-dropdown" *ngIf="showFilter" @filterAnimation>
          <label class="filter-label">
            Profession :
            <input
              type="text"
              [(ngModel)]="filterProfession"
              (input)="applyFilters()"
              class="filter-input"
              placeholder="Filtrer par profession"
              aria-label="Filtrer par profession"
            />
          </label>
        </div>
      </div>
    </div>

    <!-- Adherents Table -->
    <div class="table-container">
      <table>
        <thead>
          <tr>
            <th>CODE</th>
            <th>NOM</th>
            <th>PRÉNOM</th>
            <th>PROFESSION</th>
            <th>EMAIL</th>
            <th>ADRESSE</th>
            <th>TÉLÉPHONE 1</th>
            <th>TÉLÉPHONE 2</th>
            <th>DATE NAISSANCE</th>
            <th>CIN</th>
            <th>CODE TVA</th>
            <th>ID POINTAGE</th>
            <th>RAISON SOCIALE</th>
            <th>CODE SOCIÉTÉ</th>
            <th>ACTIONS</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let adherent of filteredAdherents">
            <td>{{ adherent.code || 'N/A' }}</td>
            <td>{{ adherent.nom || 'N/A' }}</td>
            <td>{{ adherent.prenom || 'N/A' }}</td>
            <td>{{ adherent.profession || 'N/A' }}</td>
            <td>{{ adherent.email || 'N/A' }}</td>
            <td>{{ adherent.adresse || 'N/A' }}</td>
            <td>{{ adherent.tel1 || 'N/A' }}</td>
            <td>{{ adherent.tel2 || 'N/A' }}</td>
            <td>{{ adherent.datenaissance || 'N/A' }}</td>
            <td>{{ adherent.cin || 'N/A' }}</td>
            <td>{{ adherent.codetva || 'N/A' }}</td>
            <td>{{ adherent.idpointage || 'N/A' }}</td>
            <td>{{ adherent.raisonsoc || 'N/A' }}</td>
            <td>{{ adherent.societe_code || 'N/A' }}</td>
            <td class="actions">
              <button class="action-btn view" (click)="viewAdherent(adherent)" title="Voir" aria-label="Voir les détails">👁️</button>
              <button class="action-btn delete" (click)="confirmDeleteAdherent(adherent)" title="Supprimer" aria-label="Supprimer l'adhérent">🗑️</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>